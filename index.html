<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Employee Data Entry â€” Pro</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand:#2563eb; /* blue-600 */
      --brand-600:#2563eb;
      --brand-700:#1d4ed8;
      --muted:#f5f7fb;
      --card:#ffffff;
      --text:#0f172a; /* slate-900 */
      --subtext:#475569; /* slate-600 */
      --ring:rgba(37,99,235,.25);
      --ok:#16a34a; /* green-600 */
      --warn:#ea580c; /* orange-600 */
      --danger:#dc2626; /* red-600 */
      --border:#e5e7eb;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; padding:24px; background:linear-gradient(180deg,#eef2ff, #f8fafc 120%);
      font-family:'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, 'Apple Color Emoji','Segoe UI Emoji';
      color:var(--text);
    }
    .container{max-width:1200px; margin:0 auto;}
    .app{
      background:var(--card); border-radius:16px; box-shadow:0 10px 30px rgba(2,6,23,.08);
      border:1px solid var(--border);
    }
    header{padding:24px 24px 8px 24px;}
    h1{margin:0; font-size:28px; letter-spacing:.3px}
    .sub{color:var(--subtext); font-size:14px}

    /* Progress */
    .steps{display:grid; grid-template-columns:repeat(4,1fr); gap:8px; padding:16px 24px 8px}
    .step{position:relative; padding:12px; background:var(--muted); border-radius:12px; text-align:center; color:var(--subtext); font-weight:600; font-size:14px; border:1px dashed #e2e8f0}
    .step.active{background:rgba(37,99,235,.08); color:var(--brand-700); border-color:rgba(37,99,235,.25)}
    .step::after{content:""; position:absolute; inset:0; border-radius:12px; box-shadow:inset 0 0 0 0px rgba(37,99,235,.0); transition:.25s}
    .step.active::after{box-shadow:inset 0 0 0 2px rgba(37,99,235,.25)}

    .content{padding:24px; display:grid; gap:16px}
    .card{background:#fff; border:1px solid var(--border); border-radius:12px; padding:16px}
    .grid-2{display:grid; grid-template-columns:repeat(2,1fr); gap:16px}
    .grid-3{display:grid; grid-template-columns:repeat(3,1fr); gap:16px}
    .grid-1{display:grid; grid-template-columns:1fr; gap:16px}

    @media (max-width: 900px){
      .grid-2,.grid-3{grid-template-columns:1fr}
    }

    .field{display:flex; flex-direction:column; gap:8px}
    label{font-weight:600; color:#334155; font-size:14px}
    input, select{
      width:100%; padding:12px 14px; border:1px solid #e2e8f0; border-radius:10px; font-size:15px;
      background:#fff; transition:border .2s, box-shadow .2s;
    }
    input:focus, select:focus{outline:none; border-color:var(--brand-600); box-shadow:0 0 0 4px var(--ring)}
    .error{border-color:var(--danger)!important; box-shadow:0 0 0 4px rgba(220,38,38,.15)!important}
    .hint{font-size:12px; color:#64748b}

    .photo-drop{
      border:2px dashed #cbd5e1; border-radius:12px; padding:20px; text-align:center; cursor:pointer; transition:border .2s, background .2s;
      background:#fafafa
    }
    .photo-drop:hover{border-color:var(--brand-600); background:#f8fbff}
    .preview{width:140px; height:140px; object-fit:cover; border-radius:12px; display:none; margin-top:12px; border:1px solid var(--border)}

    .actions{display:flex; justify-content:space-between; gap:12px; padding:8px 24px 24px}
    .btn{
      padding:12px 18px; border:none; border-radius:12px; cursor:pointer; font-weight:700; font-size:14px;
      transition:transform .05s ease, background .2s; display:inline-flex; align-items:center; gap:8px
    }
    .btn:active{transform:translateY(1px)}
    .primary{background:var(--brand-600); color:#fff}
    .primary:hover{background:var(--brand-700)}
    .ghost{background:#edf2ff; color:var(--brand-700)}
    .ghost:hover{background:#e0e7ff}
    .danger{background:var(--danger); color:#fff}
    .muted{background:#f1f5f9; color:#0f172a}

    .toolbar{display:flex; flex-wrap:wrap; gap:8px; padding:16px 24px; border-top:1px solid var(--border); background:#fafafa; border-bottom:1px solid var(--border)}

    /* Search results */
    #searchResults{max-height:360px; overflow:auto; border:1px solid var(--border); border-radius:12px; background:#fff}
    .result{display:grid; grid-template-columns:90px 1fr auto; gap:16px; padding:14px; border-bottom:1px solid #f1f5f9; align-items:center}
    .result:last-child{border-bottom:none}
    .avatar{width:90px; height:90px; border-radius:10px; background:#eef2ff; display:flex; align-items:center; justify-content:center; color:#64748b; font-size:12px; border:1px solid var(--border); overflow:hidden}
    .info{display:grid; grid-template-columns:repeat(3,1fr); gap:8px}
    .tag{display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; background:#f1f5f9; color:#0f172a; border:1px solid var(--border)}
    .row{font-size:14px; color:#0f172a}
    .row b{color:#334155}
    .result .btn{padding:8px 12px; border-radius:10px; font-weight:600}

    .hidden{display:none}
  </style>
</head>
<body>
  <div class="container">
    <div class="app" id="app">
      <header>
        <h1>Employee Data Entry</h1>
        <div class="sub">Multiâ€‘step form â€¢ Validation â€¢ Local storage â€¢ Edit/Delete â€¢ CSV Export</div>
      </header>

      <!-- Stepper -->
      <div class="steps">
        <div class="step active" data-step="1">1. Personal</div>
        <div class="step" data-step="2">2. Additional</div>
        <div class="step" data-step="3">3. Contact</div>
        <div class="step" data-step="4">4. Photo</div>
      </div>

      <div class="content">
        <!-- STEP 1: Personal -->
        <div class="card step-pane" id="step-1">
          <div class="grid-3">
            <div class="field"><label for="name">Name *</label><input type="text" id="name" required></div>
            <div class="field"><label for="empId">Emp ID *</label><input type="text" id="empId" required></div>
            <div class="field"><label for="designation">Designation *</label><input type="text" id="designation" required></div>

            <div class="field"><label for="cnic">CNIC No *</label><input type="text" id="cnic" placeholder="12345-1234567-1" required></div>
            <div class="field"><label for="age">Age *</label><input type="number" id="age" min="16" max="80" required></div>
            <div class="field"><label for="fatherName">Father/Husband Name *</label><input type="text" id="fatherName" required></div>

            <div class="field"><label for="cnicExpiry">CNIC Expiry *</label><input type="date" id="cnicExpiry" required></div>
            <div class="field"><label for="birthDate">Birth Date *</label><input type="date" id="birthDate" required></div>
            <div class="field"><label for="birthPlace">Place of Birth *</label><input type="text" id="birthPlace" required></div>
          </div>
          <div class="hint">Fields marked * are required.</div>
        </div>

        <!-- STEP 2: Additional -->
        <div class="card step-pane hidden" id="step-2">
          <div class="grid-3">
            <div class="field"><label for="gender">Gender *</label>
              <select id="gender" required>
                <option value="">Select</option>
                <option>Male</option>
                <option>Female</option>
                <option>Other</option>
              </select>
            </div>
            <div class="field"><label for="maritalStatus">Marital Status *</label>
              <select id="maritalStatus" required>
                <option value="">Select</option>
                <option>Single</option>
                <option>Married</option>
                <option>Divorced</option>
                <option>Widowed</option>
              </select>
            </div>
            <div class="field"><label for="religion">Religion *</label><input type="text" id="religion" required></div>

            <div class="field"><label for="country">Country *</label><input type="text" id="country" required></div>
            <div class="field"><label for="telephone">Telephone</label><input type="tel" id="telephone" placeholder="021-XXXXXXX"></div>
            <div class="field"><label for="mobile">Mobile No *</label><input type="tel" id="mobile" placeholder="03XX-XXXXXXX or +92XXXXXXXXXX" required></div>

            <div class="field"><label for="emergencyContact">Emergency Contact No *</label><input type="tel" id="emergencyContact" placeholder="03XX-XXXXXXX" required></div>
            <div class="field"><label for="bloodGroup">Blood Group</label><input type="text" id="bloodGroup" placeholder="A+, O-, etc"></div>
          </div>
        </div>

        <!-- STEP 3: Contact -->
        <div class="card step-pane hidden" id="step-3">
          <div class="grid-2">
            <div class="field"><label for="emergencyName">Emergency Contact Name *</label><input type="text" id="emergencyName" required></div>
            <div class="field"><label for="personalEmail">Personal Email</label><input type="email" id="personalEmail" placeholder="name@example.com"></div>
            <div class="field"><label for="officialEmail">Official Email</label><input type="email" id="officialEmail" placeholder="name@company.com"></div>
            <div class="field"><label for="address">Address *</label><input type="text" id="address" required></div>
            <div class="field"><label for="permanentAddress">Permanent Address *</label><input type="text" id="permanentAddress" required></div>
          </div>
        </div>

        <!-- STEP 4: Photo -->
        <div class="card step-pane hidden" id="step-4">
          <label for="imageUpload" class="photo-drop">
            <div><b>Upload Employee Photo</b><div class="hint">Click to choose an image</div></div>
            <img id="photoPreview" class="preview" alt="Preview" />
            <input type="file" id="imageUpload" accept="image/*" class="hidden" />
          </label>
        </div>
      </div>

      <!-- Wizard controls -->
      <div class="actions">
        <div style="display:flex; gap:8px">
          <button class="btn ghost" id="prevBtn">â—€ Back</button>
          <button class="btn primary" id="nextBtn">Next â–¶</button>
        </div>
        <div style="display:flex; gap:8px">
          <button class="btn muted" id="clearBtn">Clear Form</button>
          <button class="btn primary" id="saveBtn">ðŸ’¾ Save Record</button>
        </div>
      </div>

      <!-- Toolbar (search + export) -->
      <div class="toolbar">
        <div class="field" style="flex:1; min-width:220px">
          <label for="searchName">Search by Name</label>
          <input type="text" id="searchName" placeholder="Enter employee name" />
        </div>
        <div style="display:flex; gap:8px; align-items:flex-end">
          <button class="btn primary" id="executeSearch">Search</button>
          <button class="btn muted" id="resetSearch">Reset</button>
          <button class="btn ghost" id="exportAll">â¬‡ Export All (CSV)</button>
          <button class="btn ghost" id="exportFiltered">â¬‡ Export Results (CSV)</button>
        </div>
      </div>

      <div class="content">
        <div class="card">
          <div id="searchResults"><div style="padding:18px; text-align:center; color:#64748b">Search results will appear here</div></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ------------------------------
    // Storage helpers
    // ------------------------------
    const STORAGE_KEY = 'employeeData';
    const getData = () => JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    const setData = (arr) => localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
    if(!localStorage.getItem(STORAGE_KEY)) setData([]);

    // ------------------------------
    // DOM refs
    // ------------------------------
    const steps = Array.from(document.querySelectorAll('.step'));
    const panes = [1,2,3,4].map(n => document.getElementById('step-'+n));
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const saveBtn = document.getElementById('saveBtn');
    const clearBtn = document.getElementById('clearBtn');
    const imageUpload = document.getElementById('imageUpload');
    const photoPreview = document.getElementById('photoPreview');

    const executeSearch = document.getElementById('executeSearch');
    const resetSearch = document.getElementById('resetSearch');
    const searchName = document.getElementById('searchName');
    const searchResults = document.getElementById('searchResults');
    const exportAllBtn = document.getElementById('exportAll');
    const exportFilteredBtn = document.getElementById('exportFiltered');

    const requiredIds = ['name','empId','designation','cnic','age','fatherName','cnicExpiry','birthDate','birthPlace','gender','maritalStatus','religion','country','mobile','emergencyContact','emergencyName','address','permanentAddress'];

    let currentStep = 1;
    let editId = null; // when editing an existing record
    let lastResults = []; // cache for export filtered

    function goto(step){
      currentStep = Math.max(1, Math.min(4, step));
      panes.forEach((p,i)=> p.classList.toggle('hidden', i+1 !== currentStep));
      steps.forEach((s,i)=> s.classList.toggle('active', i+1 === currentStep));
      prevBtn.disabled = currentStep===1;
      nextBtn.disabled = currentStep===4;
    }
    prevBtn.addEventListener('click', ()=> goto(currentStep-1));
    nextBtn.addEventListener('click', ()=> {
      if(validateStep(currentStep)) goto(currentStep+1);
    });

    // ------------------------------
    // Validation (CNIC & Mobile)
    // ------------------------------
    const patterns = {
      cnic: /^\d{5}-\d{7}-\d$/, // 12345-1234567-1
      mobile: /^(?:\+92\s?3\d{2}\s?\d{7}|03\d{2}[- ]?\d{7})$/ // +92 3XX XXXXXXX or 03XX-XXXXXXX
    };

    function val(id){ return document.getElementById(id).value.trim(); }
    function setErr(id, on){ const el = document.getElementById(id); el.classList.toggle('error', !!on); }

    function validateStep(step){
      let ok = true;
      const stepFields = {
        1:['name','empId','designation','cnic','age','fatherName','cnicExpiry','birthDate','birthPlace'],
        2:['gender','maritalStatus','religion','country','mobile','emergencyContact'],
        3:['emergencyName','address','permanentAddress'],
        4:[]
      }[step];
      stepFields.forEach(id=>{
        const empty = !val(id);
        setErr(id, empty);
        if(empty) ok=false;
      });
      // Special patterns
      if(step>=1){
        if(val('cnic') && !patterns.cnic.test(val('cnic'))){ setErr('cnic', true); ok=false; }
        else setErr('cnic', false);
      }
      if(step>=2){
        if(val('mobile') && !patterns.mobile.test(val('mobile'))){ setErr('mobile', true); ok=false; } else setErr('mobile', false);
        if(val('emergencyContact') && !patterns.mobile.test(val('emergencyContact'))){ setErr('emergencyContact', true); ok=false; } else setErr('emergencyContact', false);
      }
      return ok;
    }

    function validateAll(){
      for(let s=1;s<=4;s++){ if(!validateStep(s)) { goto(s); return false; } }
      return true;
    }

    // ------------------------------
    // Photo upload preview
    // ------------------------------
    imageUpload.addEventListener('change', function(){
      const file = this.files[0];
      if(file){
        const reader = new FileReader();
        reader.onload = e => { photoPreview.src = e.target.result; photoPreview.style.display = 'block'; };
        reader.readAsDataURL(file);
      }
    });

    // ------------------------------
    // Build employee object from form
    // ------------------------------
    function buildEmployee(){
      return {
        id: editId || ('emp_' + Date.now() + '_' + Math.random().toString(36).slice(2,7)),
        name: val('name'),
        empId: val('empId'),
        designation: val('designation'),
        cnic: val('cnic'),
        age: val('age'),
        fatherName: val('fatherName'),
        cnicExpiry: val('cnicExpiry'),
        birthDate: val('birthDate'),
        birthPlace: val('birthPlace'),
        gender: val('gender'),
        maritalStatus: val('maritalStatus'),
        religion: val('religion'),
        country: val('country'),
        telephone: val('telephone'),
        mobile: val('mobile'),
        emergencyContact: val('emergencyContact'),
        bloodGroup: val('bloodGroup'),
        emergencyName: val('emergencyName'),
        personalEmail: val('personalEmail'),
        officialEmail: val('officialEmail'),
        address: val('address'),
        permanentAddress: val('permanentAddress'),
        photo: photoPreview && photoPreview.style.display === 'block' ? photoPreview.src : null,
        updatedAt: new Date().toISOString()
      };
    }

    function fillForm(emp){
      const map = [
        'name','empId','designation','cnic','age','fatherName','cnicExpiry','birthDate','birthPlace','gender','maritalStatus','religion','country','telephone','mobile','emergencyContact','bloodGroup','emergencyName','personalEmail','officialEmail','address','permanentAddress'
      ];
      map.forEach(id=>{ const el = document.getElementById(id); if(el) el.value = emp[id] || ''; });
      if(emp.photo){ photoPreview.src = emp.photo; photoPreview.style.display = 'block'; } else { photoPreview.style.display = 'none'; photoPreview.src=''; }
    }

    function clearForm(){
      const inputs = document.querySelectorAll('input, select');
      inputs.forEach(i=>{ i.value=''; i.classList.remove('error'); });
      if(imageUpload) imageUpload.value='';
      photoPreview.style.display='none'; photoPreview.src='';
      editId = null;
      goto(1);
    }
    clearBtn.addEventListener('click', clearForm);

    // ------------------------------
    // Save / Update
    // ------------------------------
    saveBtn.addEventListener('click', ()=>{
      if(!validateAll()) return alert('Please fix validation errors before saving.');
      const emp = buildEmployee();
      const all = getData();
      const idx = all.findIndex(e=> e.id === emp.id);
      if(idx > -1){ all[idx] = emp; alert('Employee record updated successfully!'); }
      else { all.push(emp); alert('Employee record saved successfully!'); }
      setData(all);
      clearForm();
      // refresh search if filter active
      if(searchName.value.trim()) performSearch(); else renderResults(all);
    });

    // ------------------------------
    // Search / Results
    // ------------------------------
    function performSearch(){
      const q = searchName.value.trim().toLowerCase();
      const all = getData();
      const results = q ? all.filter(e => e.name.toLowerCase().includes(q)) : all;
      renderResults(results);
    }
    executeSearch.addEventListener('click', performSearch);
    resetSearch.addEventListener('click', ()=>{ searchName.value=''; performSearch(); });

    function renderResults(results){
      lastResults = results.slice();
      if(!results.length){
        searchResults.innerHTML = '<div style="padding:18px; text-align:center; color:#64748b">No matching employees found.</div>';
        return;
      }
      const rows = results.map(e=> `
        <div class="result">
          <div class="avatar">${e.photo ? `<img src="${e.photo}" alt="${e.name}" style="width:100%;height:100%;object-fit:cover">` : 'No Photo'}</div>
          <div class="info">
            <div class="row"><b>Name:</b> ${escapeHtml(e.name)}</div>
            <div class="row"><b>Emp ID:</b> ${escapeHtml(e.empId)}</div>
            <div class="row"><b>Designation:</b> ${escapeHtml(e.designation)}</div>
            <div class="row"><b>CNIC:</b> <span class="tag">${escapeHtml(e.cnic)}</span></div>
            <div class="row"><b>Mobile:</b> ${escapeHtml(e.mobile || '')}</div>
            <div class="row"><b>Emergency:</b> ${escapeHtml(e.emergencyName || '')} â€” ${escapeHtml(e.emergencyContact || '')}</div>
          </div>
          <div>
            <button class="btn ghost" onclick='onEdit("${e.id}")'>Edit</button>
            <button class="btn danger" onclick='onDelete("${e.id}")'>Delete</button>
          </div>
        </div>`).join('');
      searchResults.innerHTML = rows;
    }

    window.onEdit = (id)=>{
      const all = getData();
      const emp = all.find(x=> x.id===id);
      if(!emp) return;
      editId = id;
      fillForm(emp);
      goto(1);
      window.scrollTo({top:0, behavior:'smooth'});
    }

    window.onDelete = (id)=>{
      const all = getData();
      const emp = all.find(x=> x.id===id);
      if(!emp) return;
      if(confirm(`Delete record for ${emp.name}? This cannot be undone.`)){
        const next = all.filter(x=> x.id!==id);
        setData(next);
        performSearch();
      }
    }

    // ------------------------------
    // CSV Export
    // ------------------------------
    function toCSV(arr){
      if(!arr.length) return '';
      const cols = Object.keys(arr[0]);
      const esc = v => '"' + String(v==null?'':v).replace(/"/g,'""') + '"';
      const header = cols.join(',');
      const body = arr.map(o=> cols.map(k=> esc(o[k])).join(',')).join('\n');
      return header + '\n' + body;
    }

    function downloadCSV(filename, rows){
      const csv = toCSV(rows);
      if(!csv){ alert('No data to export.'); return; }
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename; document.body.appendChild(a); a.click();
      setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 0);
    }

    exportAllBtn.addEventListener('click', ()=> downloadCSV('employees_all.csv', getData()));
    exportFilteredBtn.addEventListener('click', ()=> downloadCSV('employees_results.csv', lastResults));

    // Utility: escape HTML for safe rendering
    function escapeHtml(str){
      return String(str||'').replace(/[&<>"]/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[s]));
    }

    // Initial render (show all)
    renderResults(getData());
    goto(1);
  </script>
</body>
</html>
